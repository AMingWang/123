<html><head>
        <title>VATBoard</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.16.0/dist/bootstrap-table.min.css">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" crossorigin="anonymous">
        <link href="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/css/bootstrap4-toggle.min.css" rel="stylesheet">
        <link rel="stylesheet" href="resources/vatboard.css">
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script type="text/javascript" async="" src="https://www.google-analytics.com/analytics.js"></script><script type="text/javascript" async="" src="https://www.googletagmanager.com/gtag/js?id=G-W37ML10HJ6&amp;l=dataLayer&amp;cx=c&amp;gtm=457e53c0za200&amp;tag_exp=102482433~102587591~102640600~102717422~102788824~102791784~102814059~102825837"></script><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-43943268-2"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag() {
                dataLayer.push(arguments);
            }
            gtag('js', new Date());

            gtag('config', 'UA-43943268-2');
        </script>
    </head>
    <body>
        <div style="margin-top:15px;" class="container-fluid">
            <div class="row">
                <div class="col-3">
                    <div class="container-fluid">
                        <img id="dep-icon" src="resources/dep-icon.png" width="70" alt="dep" style="margin-right:30px;">
                        <img id="arr-icon" src="resources/arr-icon-enable.png" width="70" alt="arr">                        
                    </div>
                </div>
                <div class="col-2">
                    <div class="container-fluid">
                        <p>Arrivals:<span style="margin-left:5px;" id="arrcount">1</span> </p><p>Departures:<span id="depcount" style="margin-left:5px;">1</span></p>    
                    </div>
                </div>
                <div class="col-3 text-center">
                    <div class="container-fluid text-center" style="margin:auto;">
                        <span id="vattitle">VATBoard - Flights Board for RCTP</span>
                    </div>
                </div>
                <div class="col-4">
                    <div class="container-fluid text-center" style="margin:auto;">
                        <p>
                            <span id="MyClockDisplay" class="clock text-center align-middle" onload="showTime()">13:54:07 </span>
                            <span style="font-size:0.8em;vertical-align:super;">UTC</span>
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <div class="bootstrap-table bootstrap4">
      <div class="fixed-table-toolbar"></div>
      
      <div class="fixed-table-container fixed-height" style="height: 400px; padding-bottom: 35.0938px;">
      <div class="fixed-table-header" style="margin-right: 15px;"><table class="table-sm table-dark table-borderless table table-bordered table-hover" style="width: 678.484px;"><thead class="thead-light"><tr><th class="vat-center" style="" data-field="callsign"><div class="th-inner ">Callsign</div><div class="fht-cell" style="width: 77.3281px;"></div></th><th class="vat-center" style="" data-field="planned_depairport"><div class="th-inner ">Route</div><div class="fht-cell" style="width: 53.9219px;"></div></th><th class="vat-center" style="" data-field="planned_aircraft"><div class="th-inner ">Aircraft</div><div class="fht-cell" style="width: 288.406px;"></div></th><th class="vat-right" style="" data-field="altitude"><div class="th-inner ">Altitude</div><div class="fht-cell" style="width: 70.6406px;"></div></th><th class="vat-right" style="" data-field="groundspeed"><div class="th-inner ">GS</div><div class="fht-cell" style="width: 35.4688px;"></div></th><th class="vat-right" style="" data-field="dest_distance"><div class="th-inner ">NM inbound</div><div class="fht-cell" style="width: 105.156px;"></div></th><th class="vat-center" style="" data-field="ETA"><div class="th-inner ">ETA</div><div class="fht-cell" style="width: 47.5625px;"></div></th></tr></thead></table></div>
      <div class="fixed-table-body">
      <div class="fixed-table-loading table table-bordered table-hover fixed-table-border" style="top: 35.0938px; width: 678.484px;">
      <span class="loading-wrap">
      <span class="loading-text">Loading, please wait</span>
      <span class="animation-wrap"><span class="animation-dot"></span></span>
      </span>
      </div>
      <table id="table" class="table-sm table-dark table-borderless table table-bordered table-hover" data-row-style="rowStyle" data-show-pagination-switch="false" data-pagination="false" data-height="400" data-virtual-scroll="true" data-only-info-pagination="true" data-pagination-loop="false" style="margin-top: -34.0938px;">
                <thead class="thead-light"><tr><th class="vat-center" style="" data-field="callsign"><div class="th-inner ">Callsign</div><div class="fht-cell"></div></th><th class="vat-center" style="" data-field="planned_depairport"><div class="th-inner ">Route</div><div class="fht-cell"></div></th><th class="vat-center" style="" data-field="planned_aircraft"><div class="th-inner ">Aircraft</div><div class="fht-cell"></div></th><th class="vat-right" style="" data-field="altitude"><div class="th-inner ">Altitude</div><div class="fht-cell"></div></th><th class="vat-right" style="" data-field="groundspeed"><div class="th-inner ">GS</div><div class="fht-cell"></div></th><th class="vat-right" style="" data-field="dest_distance"><div class="th-inner ">NM inbound</div><div class="fht-cell"></div></th><th class="vat-center" style="" data-field="ETA"><div class="th-inner ">ETA</div><div class="fht-cell"></div></th></tr></thead>
            <tbody style=""><tr data-index="0"><td class="vat-center" style="border-bottom: 1pt dotted #776600; "><img alt="" width="24px" src="resources/logos/GTI.png"><span style="margin-left:10px;">GTI9357</span></td><td class="vat-center" style="border-bottom: 1pt dotted #776600; ">EBLG<span id="arrow-route-container"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 16 16"><path class="arrow-route" d="M7.5 11.5L9 13l5-5-5-5-1.5 1.5L10.179 7H2v2h8.179L7.5 11.5z"></path></svg></span>RCTP</td><td class="vat-center" style="border-bottom: 1pt dotted #776600; ">B77L/H-SDE1E2E3FGHIJ2J3J4J5M1RWXY/LB1D1</td><td class="vat-right" style="border-bottom: 1pt dotted #776600; ">32.796</td><td class="vat-right" style="border-bottom: 1pt dotted #776600; ">593</td><td class="vat-right" style="border-bottom: 1pt dotted #776600; ">2.522</td><td class="vat-center" style="border-bottom: 1pt dotted #776600; ">18:08</td></tr></tbody></table><div class="fixed-table-border" style="width: 432.891px; height: 348.406px;"></div></div>
      <div class="fixed-table-footer" style="display: none;"><table><thead><tr></tr></thead></table></div>
      </div>
      <div class="fixed-table-pagination" style="display: none;"></div>
      </div><div class="clearfix"></div>
            <div class="row-fluid text-center">
                <span id="appinfo" class="text-center">Â© 2020 Elias Stassinos, v1.09-20-g14c0210
</span>     
            </div>

        </div>
        <script src="resources/jquery-3.5.0.min.js"></script>
        <script src="https://unpkg.com/bootstrap-table@1.16.0/dist/bootstrap-table.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/js/bootstrap4-toggle.min.js"></script>
        <script>
                                function logoFormatter(value, row, index) {
                                    var airline = value.trim().substring(0, 3);
                                    return '<img alt="" width=24px src="resources/logos/' + airline + '.png"><span style="margin-left:10px;">' + value + '</span>';
                                }
                                function airportsFormatter(value, row, index) {
                                    return [
                                        value,
                                        '<span id="arrow-route-container"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 16 16"><path class="arrow-route" d="M7.5 11.5L9 13l5-5-5-5-1.5 1.5L10.179 7H2v2h8.179L7.5 11.5z"/></svg></span>',
                                        row.planned_destairport
                                    ].join('');
                                }
                                function rowStyle(row, index) {
                                    return {
                                        css: {
                                            'border-bottom': '1pt dotted #776600'
                                        }
                                    }
                                }
                                $(function () {
                                    var vatsimdata = [];
                                    var currentMode = '';
                                    var arrivals = 0;
                                    var departures = 0;
                                    var timerPrimary;
                                    var timerFadeout;
                                    var $table = $('#table');
                                    var icao_url = getUrlParam('icao', 'LGAV').toUpperCase();
                                    //
                                    //MAIN
                                    //
                                    $table.bootstrapTable({
                                    });
                                    getVersion();
                                    getData();
                                    timerPrimary = setInterval(getData, 120000);
                                    showTime();
                                    setDistanceTitle();
                                    //        
                                    //Functions/Methods
                                    //
                                    function getData() {
                                        $.getJSON('getpilots.php', {icao: escape(icao_url)}, function (d) {
                                            vatsimdata = d;
                                            postgetData(d);
                                        });
                                    }
                                    function getVersion() {
                                        $.getJSON('getversion.php', function (ver) {
                                            var fullInfo = '\251 2020 Elias Stassinos, ' + ver;
                                            $('#appinfo').text(fullInfo);
                                        });
                                    }
                                    function postgetData(d) {
                                        $('#vattitle').text("VATBoard - Flights Board for " + icao_url);
                                        stopfadeoutFirst();
                                        prepareCounters(d);
                                        updateCounters(d);
                                        //Do the loop until reload
                                        doLoop();
                                        setTimeout(function () {
                                            doLoop();
                                        }, 60000);
                                    }
                                    function doLoop() {
                                        determineFilter(vatsimdata);
                                        fadeoutFirst();
                                    }
                                    function setDistanceTitle() {
                                        $table.bootstrapTable('updateColumnTitle', {
                                            field: 'dep_distance',
                                            title: 'NM outound'
                                        });
                                        $table.bootstrapTable('updateColumnTitle', {
                                            field: 'dest_distance',
                                            title: 'NM inbound'
                                        });
                                    }
                                    function getUrlParam(parameter, defaultvalue) {
                                        var urlparameter = defaultvalue;
                                        if (window.location.href.indexOf(parameter) > -1) {
                                            urlparameter = getUrlVars()[parameter];
                                        }
                                        return urlparameter;
                                    }
                                    function getUrlVars() {
                                        var vars = {};
                                        var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function (m, key, value) {
                                            vars[key] = value;
                                        });
                                        return vars;
                                    }
                                    function determineFilter(d) {
                                        if (currentMode === 'arr') {
                                            filterDepartures(d);
                                        } else {
                                            filterArrivals(d);
                                        }
                                    }
                                    function filterArrivals(d) {
                                        stopfadeoutFirst();
                                        currentMode = 'arr';
                                        $table.bootstrapTable('hideColumn', 'dep_distance');
                                        $table.bootstrapTable('showColumn', 'dest_distance');
                                        $('#arr-icon').attr('src', 'resources/arr-icon-enable.png');
                                        $('#dep-icon').attr('src', 'resources/dep-icon.png');
                                        $('#table tbody').fadeOut(1000, function () {
                                            $table.bootstrapTable('load', d);
                                            $table.bootstrapTable(
                                                    'filterBy', {planned_destairport: icao_url});
                                        }).fadeIn(1000);
                                    }
                                    function filterDepartures(d) {
                                        stopfadeoutFirst();
                                        currentMode = 'dep';
                                        $table.bootstrapTable('showColumn', 'dep_distance');
                                        $table.bootstrapTable('hideColumn', 'dest_distance');
                                        $('#arr-icon').attr('src', 'resources/arr-icon.png');
                                        $('#dep-icon').attr('src', 'resources/dep-icon-enable.png');
                                        $('#table tbody').fadeOut(1000, function () {
                                            $table.bootstrapTable('load', d);
                                            $table.bootstrapTable('filterBy', {
                                                planned_depairport: icao_url
                                            });
                                        }).fadeIn(1000);
                                    }
                                    function updateCounters(d) {
                                        $('#arrcount').text(arrivals);
                                        $('#depcount').text(departures);
                                    }
                                    function prepareCounters(d) {
                                        arrivals = d.filter(v => v.planned_destairport === icao_url).length;
                                        departures = d.filter(v => v.planned_depairport === icao_url).length;
                                    }
                                    function fadeoutFirst() {
                                        timerFadeout = setInterval(function () {
                                            if ($('#table tbody tr').length <= 10) {
                                                stopfadeoutFirst();
                                            } else {
                                                let row = $('#table tbody tr:first')
                                                row.animate({opacity: 0}, 1000, function () {
                                                    let col = row.find('td')
                                                    col
                                                            .wrapInner('<div style="display: block;" />')
                                                            .parent()
                                                            .find('td > div')
                                                            .animate({
                                                                height: 0
                                                            }, 1000);

                                                    col.animate({
                                                        padding: 0
                                                    }, 1000, function () {
                                                        row.remove();
                                                    });
                                                    $(this).slideUp(1000, function () {
                                                        row.remove();
                                                    });
                                                });
                                            }
                                        }, 3500);
                                    }
                                    function stopfadeoutFirst() {
                                        clearTimeout(timerFadeout);
                                    }
                                    function showTime() {
                                        var date = new Date();
                                        var offsetHours = date.getTimezoneOffset() / 60;
                                        var h = date.getUTCHours() // 0 - 23
                                        var m = date.getMinutes(); // 0 - 59
                                        var s = date.getSeconds(); // 0 - 59
                                        h = (h < 0) ? 24 - h : h;
                                        h = (h < 10) ? "0" + h : h;
                                        m = (m < 10) ? "0" + m : m;
                                        s = (s < 10) ? "0" + s : s;

                                        var time = h + ":" + m + ":" + s + " ";
                                        document.getElementById("MyClockDisplay").innerText = time;
                                        document.getElementById("MyClockDisplay").textContent = time;

                                        setTimeout(showTime, 1000);

                                    }
                                    $("#arr-icon").click(function () {
                                        doLoop();
                                    });
                                    $("#dep-icon").click(function () {
                                        doLoop();
                                    });
                                });
        </script>
    

</body></html>
