<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>警員案件紀錄系統</title>
    <style>
        /* 之前的 CSS 保持不變 */
    </style>
</head>
<body>
    <div class="container">
        <h2>警員案件紀錄系統</h2>

        <!-- 夜間模式切換 -->
        <button onclick="toggleNightMode()">切換夜間模式</button>

        <!-- 登入區域 -->
        <div id="loginArea">
            <label>請選擇登入身份：</label>
            <button onclick="showLogin('admin')">管理員登入</button>
            <button onclick="showLogin('officer')">警員登入</button>
        </div>

        <!-- 管理員登入 -->
        <div id="adminLogin" style="display:none;">
            <label>請輸入管理員密碼：</label>
            <input type="password" id="adminPassword" placeholder="輸入密碼" />
            <button onclick="loginAsAdmin()">登入管理員</button>
            <button onclick="cancelLogin()">取消</button>
        </div>

        <!-- 警員登入 -->
        <div id="officerLogin" style="display:none;">
            <label>請輸入警員帳號：</label>
            <input type="text" id="officerUsername" placeholder="輸入警員帳號" />
            <label>請輸入密碼：</label>
            <input type="password" id="officerPassword" placeholder="輸入密碼" />
            <button onclick="loginAsOfficer()">登入警員</button>
            <button onclick="cancelLogin()">取消</button>
        </div>

        <!-- 管理員登入後的表單 -->
        <div id="caseForm" style="display:none;">
            <!-- 跟之前一樣的案件提交表單 -->
        </div>

        <!-- 警員登入後的表單 -->
        <div id="officerForm" style="display:none;">
            <!-- 警員只能提交案件紀錄 -->
            <label>警員姓名：</label>
            <input type="text" id="officerName" placeholder="輸入警員姓名" /><br>

            <label>案件標題：</label>
            <input type="text" id="caseTitle" placeholder="輸入案件標題" /><br>

            <label>案件類型：</label>
            <select id="caseType">
                <option value="刑事案件">刑事案件</option>
                <option value="交通事故">交通事故</option>
                <option value="民事糾紛">民事糾紛</option>
                <option value="其他">其他</option>
            </select><br>

            <label>案件時間：</label>
            <input type="datetime-local" id="caseTime" /><br>

            <label>案件地點：</label>
            <input type="text" id="caseLocation" placeholder="輸入案件發生地點" /><br>

            <label>涉案人員：</label>
            <input type="text" id="personsInvolved" placeholder="輸入嫌疑人、受害人等" /><br>

            <label>案件狀態：</label>
            <select id="caseStatus">
                <option value="進行中">進行中</option>
                <option value="已結案">已結案</option>
                <option value="待調查">待調查</option>
            </select><br>

            <label>案件詳情：</label><br>
            <textarea id="caseDetails" placeholder="請輸入案件詳情"></textarea><br>

            <button onclick="submitReport()">提交案件</button>
        </div>

        <h3>案件紀錄</h3>

        <input type="text" id="search" placeholder="搜尋案件" oninput="searchRecords()" /><br>

        <div class="records-container" id="recordsContainer">
            <!-- 顯示提交的案件紀錄 -->
        </div>
    </div>

    <script>
        const adminPassword = "admin123"; // 管理員密碼
        const officers = {
            "officer1": "password1",
            "officer2": "password2"
        }; // 警員帳號與密碼

        // 開啟夜間模式
        function toggleNightMode() {
            document.body.classList.toggle("night-mode");
        }

        // 顯示登入介面
        function showLogin(role) {
            if (role === 'admin') {
                document.getElementById("adminLogin").style.display = "block";
                document.getElementById("officerLogin").style.display = "none";
            } else {
                document.getElementById("officerLogin").style.display = "block";
                document.getElementById("adminLogin").style.display = "none";
            }
            document.getElementById("loginArea").style.display = "none";
        }

        // 取消登入
        function cancelLogin() {
            document.getElementById("loginArea").style.display = "block";
            document.getElementById("adminLogin").style.display = "none";
            document.getElementById("officerLogin").style.display = "none";
        }

        // 管理員登入
        function loginAsAdmin() {
            const password = document.getElementById("adminPassword").value;
            if (password === adminPassword) {
                document.getElementById("adminLogin").style.display = "none";
                document.getElementById("caseForm").style.display = "block";
                alert("管理員登入成功！");
            } else {
                alert("密碼錯誤！");
            }
        }

        // 警員登入
        function loginAsOfficer() {
            const username = document.getElementById("officerUsername").value;
            const password = document.getElementById("officerPassword").value;
            if (officers[username] && officers[username] === password) {
                document.getElementById("officerLogin").style.display = "none";
                document.getElementById("officerForm").style.display = "block";
                alert("警員登入成功！");
            } else {
                alert("帳號或密碼錯誤！");
            }
        }

        // 頁面載入時從 localStorage 讀取案件紀錄
        window.onload = function() {
            loadRecords();
        }

        // 從 localStorage 載入案件紀錄
        function loadRecords() {
            const records = JSON.parse(localStorage.getItem('caseRecords')) || [];
            const recordsContainer = document.getElementById('recordsContainer');
            recordsContainer.innerHTML = '';

            records.forEach(record => {
                const recordElement = createRecordElement(record);
                recordsContainer.appendChild(recordElement);
            });
        }

        // 儲存紀錄到 localStorage
        function saveRecord(record) {
            let records = JSON.parse(localStorage.getItem('caseRecords')) || [];
            records.push(record);
            localStorage.setItem('caseRecords', JSON.stringify(records));
        }

        // 創建案件紀錄的 HTML 元素
        function createRecordElement(record) {
            const recordElement = document.createElement('div');
            recordElement.classList.add('record-item');
            
            recordElement.innerHTML = `
                <h3>${record.caseTitle}</h3>
                <p><strong>案件編號:</strong> ${record.caseID}</p>
                <p><strong>警員姓名:</strong> ${record.officerName}</p>
                <p><strong>案件類型:</strong> ${record.caseType}</p>
                <p><strong>案件時間:</strong> ${record.formattedTime}</p>
                <p><strong>案件地點:</strong> ${record.caseLocation}</p>
                <p><strong>涉案人員:</strong> ${record.personsInvolved}</p>
                <p><strong>案件狀態:</strong> ${record.caseStatus}</p>
                <p><strong>案件詳情:</strong> ${record.caseDetails}</p>
                <div class="card-footer">
                    ${isAdmin() ? '<button onclick="editRecord(\'' + record.caseID + '\')">編輯</button>' : ''}
                    <button onclick="deleteRecord('${record.caseID}')">刪除</button>
                </div>
            `;
            
            return recordElement;
        }

        // 檢查是否是管理員
        function isAdmin() {
            return document.getElementById("caseForm").style.display === "block";
        }

        // 提交案件紀錄
        function submitReport() {
            const officerName = document.getElementById("officerName").value || "未知警員";
            const caseTitle = document.getElementById("caseTitle").value || "未命名案件";
            const caseType = document.getElementById("caseType").value;
            const caseTime = document.getElementById("caseTime").value || "未填寫";
            const caseLocation = document.getElementById("caseLocation").value || "未填寫";
            const personsInvolved = document.getElementById("personsInvolved").value || "無";
            const caseStatus = document.getElementById("caseStatus").value;
            const caseDetails = document.getElementById("caseDetails").value;
            
            if (!caseDetails) {
                alert("請輸入案件詳情");
                return;
            }
            
            // 生成自動案件編號（根據時間戳）
            const caseID = `案件編號-${new Date().getTime()}`;

            // 格式化日期時間為 24 小時制
            const formattedTime = new Date(caseTime).toLocaleString('zh-TW', { hour12: false });

            const record = {
                caseID,
                officerName,
                caseTitle,
                caseType,
                caseTime,
                formattedTime,
                caseLocation,
                personsInvolved,
                caseStatus,
                caseDetails
            };

            // 儲存案件紀錄到 localStorage
            saveRecord(record);

            // 創建並顯示案件紀錄
            const recordElement = createRecordElement(record);
            const recordsContainer = document.getElementById("recordsContainer");
            recordsContainer.appendChild(recordElement);

            // 清空表單
            document.getElementById("officerName").value = '';
            document.getElementById("caseTitle").value = '';
            document.getElementById("caseTime").value = '';
            document.getElementById("caseLocation").value = '';
            document.getElementById("personsInvolved").value = '';
            document.getElementById("caseDetails").value = '';
        }

        // 刪除案件紀錄
        function deleteRecord(caseID) {
            let records = JSON.parse(localStorage.getItem('caseRecords')) || [];
            records = records.filter(record => record.caseID !== caseID);
            localStorage.setItem('caseRecords', JSON.stringify(records));
            loadRecords();
        }

        // 編輯案件紀錄
        function editRecord(caseID) {
            let records = JSON.parse(localStorage.getItem('caseRecords')) || [];
            const record = records.find(record => record.caseID === caseID);
            if (record) {
                document.getElementById("officerName").value = record.officerName;
                document.getElementById("caseTitle").value = record.caseTitle;
                document.getElementById("caseType").value = record.caseType;
                document.getElementById("caseTime").value = record.caseTime;
                document.getElementById("caseLocation").value = record.caseLocation;
                document.getElementById("personsInvolved").value = record.personsInvolved;
                document.getElementById("caseStatus").value = record.caseStatus;
                document.getElementById("caseDetails").value = record.caseDetails;
                deleteRecord(caseID);
            }
        }

        // 搜尋案件
        function searchRecords() {
            const query = document.getElementById("search").value.toLowerCase();
            const records = JSON.parse(localStorage.getItem('caseRecords')) || [];
            const filteredRecords = records.filter(record => 
                record.caseTitle.toLowerCase().includes(query) || 
                record.officerName.toLowerCase().includes(query) || 
                record.caseStatus.toLowerCase().includes(query)
            );
            
            const recordsContainer = document.getElementById('recordsContainer');
            recordsContainer.innerHTML = '';
            filteredRecords.forEach(record => {
                const recordElement = createRecordElement(record);
                recordsContainer.appendChild(recordElement);
            });
        }
    </script>
</body>
</html>